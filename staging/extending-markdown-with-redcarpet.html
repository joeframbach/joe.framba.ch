<!DOCTYPE html>
<html>
  <head>
    <title>Joe Frambach - Extending Markdown with Redcarpet</title>
    <meta content='width=device-width, initial-scale=1, maximum-scale=1' name='viewport'>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <link href='/assets/style.css' rel='stylesheet' type='text/css'>
    <script src='//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js' type='text/javascript'></script>
    <script src='/assets/script.js' type='text/javascript'></script>
    <script src='/assets/jquery.githubRepoWidget.js' type='text/javascript'></script>
  </head>
  <body>
    <div id='header'>
      <h1>
        <a href='/'>Joe Frambach</a>
      </h1>
      <div class='tag'>
        <a class='tagname' href='/tag/bike'>
          bike x 7
          <span></span>
        </a>
      </div>
      <div class='tag'>
        <a class='tagname' href='/tag/code'>
          code x 6
          <span></span>
        </a>
      </div>
      <div class='tag'>
        <a class='tagname' href='/tag/travel'>
          travel x 3
          <span></span>
        </a>
      </div>
      <div class='tag'>
        <a class='tagname' href='/tag/couchsurfing'>
          couchsurfing x 3
          <span></span>
        </a>
      </div>
      <div class='tag'>
        <a class='tagname' href='/tag/appalachian-trail'>
          appalachian-trail x 3
          <span></span>
        </a>
      </div>
      <div class='tag'>
        <a class='tagname' href='/tag/pokemon'>
          pokemon x 2
          <span></span>
        </a>
      </div>
      <div class='tag'>
        <a class='tagname' href='/tag/javascript'>
          javascript x 2
          <span></span>
        </a>
      </div>
      <div class='tag'>
        <a class='tagname' href='/tag/marathon'>
          marathon x 2
          <span></span>
        </a>
      </div>
      <div class='tag'>
        <a class='tagname' href='/tag/canvas'>
          canvas
          <span></span>
        </a>
      </div>
      <div class='tag'>
        <a class='tagname' href='/tag/ruby'>
          ruby
          <span></span>
        </a>
      </div>
      <div class='tag'>
        <a class='tagname' href='/tag/markdown'>
          markdown
          <span></span>
        </a>
      </div>
    </div>
    <div id='content'>
      <div class='post'>
        <h2>
          <a href='/extending-markdown-with-redcarpet'>Extending Markdown with Redcarpet</a>
        </h2>
        <div class='tag'>
          <a class='tagname' href='/tag/code'>
            code
            <span></span>
          </a>
        </div>
        <div class='tag'>
          <a class='tagname' href='/tag/ruby'>
            ruby
            <span></span>
          </a>
        </div>
        <div class='tag'>
          <a class='tagname' href='/tag/markdown'>
            markdown
            <span></span>
          </a>
        </div>
        <p>Markdown uses this syntax for placing images:</p>
        <div class="CodeRay">
          <div class="code"><pre>![Alt text](/path/to/img.jpg &quot;Optional title&quot;)</pre></div>
        </div>
        
        <p>The resulting markup looks like this:</p>
        <div class="CodeRay">
          <div class="code"><pre><span style="color:#070;font-weight:bold">&lt;img</span> <span style="color:#b48">src</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/path/to/img.jpg</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">alt</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Alt text</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">title</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Optional title</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>`</pre></div>
        </div>
        
        <p>But I wanted the resulting markup to look like this:</p>
        <div class="CodeRay">
          <div class="code"><pre><span style="color:#070;font-weight:bold">&lt;figure&gt;</span>&#x000A;  <span style="color:#070;font-weight:bold">&lt;img</span> <span style="color:#b48">src</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/path/to/img.jpg</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">alt</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Alt text</span><span style="color:#710">&quot;</span></span> <span style="color:#070;font-weight:bold">/&gt;</span>&#x000A;  <span style="color:#070;font-weight:bold">&lt;figcaption&gt;</span>Optional title<span style="color:#070;font-weight:bold">&lt;/figcaption&gt;</span>&#x000A;<span style="color:#070;font-weight:bold">&lt;/figure&gt;</span></pre></div>
        </div>
        
        <p>It took a few attempts to get this going, but in the end it was surprisingly
        easy. I&#39;m rewriting the <code>image</code> method in Redcarpet, and telling Haml to use
        my extended class instead of stock Redcarpet.</p>
        <div class="CodeRay">
          <div class="code"><pre>require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">haml</span><span style="color:#710">'</span></span>&#x000A;require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">redcarpet</span><span style="color:#710">'</span></span>&#x000A;&#x000A;<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">CustomRedcarpet</span> &lt; <span style="color:#036;font-weight:bold">Redcarpet</span>::<span style="color:#036;font-weight:bold">Render</span>::<span style="color:#036;font-weight:bold">HTML</span>&#x000A;  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">image</span>(link, title, alt_text)&#x000A;    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">&lt;figure&gt;&lt;a href='</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>link<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">'&gt;&lt;img src='</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>link<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">' alt='</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>alt_text<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">' /&gt;&lt;/a&gt;&lt;figcaption&gt;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>title<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">&lt;/figcaption&gt;&lt;/figure&gt;</span><span style="color:#710">&quot;</span></span>&#x000A;  <span style="color:#080;font-weight:bold">end</span>&#x000A;<span style="color:#080;font-weight:bold">end</span>&#x000A;&#x000A;<span style="color:#080;font-weight:bold">module</span> <span style="color:#B06;font-weight:bold">Haml::Filters::Markdown</span>&#x000A;  include <span style="color:#036;font-weight:bold">Haml</span>::<span style="color:#036;font-weight:bold">Filters</span>::<span style="color:#036;font-weight:bold">Base</span>&#x000A;&#x000A;  <span style="color:#33B">@renderer</span> = <span style="color:#036;font-weight:bold">Redcarpet</span>::<span style="color:#036;font-weight:bold">Markdown</span>.new(<span style="color:#036;font-weight:bold">CustomRedcarpet</span>.new())&#x000A;&#x000A;  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">render</span>(text)&#x000A;    <span style="color:#33B">@renderer</span>.render(text)&#x000A;  <span style="color:#080;font-weight:bold">end</span>&#x000A;<span style="color:#080;font-weight:bold">end</span></pre></div>
        </div>
        <div class='github-widget' data-repo='joeframbach/joe.framba.ch'></div>
        <h1>Update</h1>
        
        <p>Some component of Ruby 2.0.0, Haml, or Redcarpet decided to not work anymore. The solution was a slight modification, below:</p>
        <div class="CodeRay">
          <div class="code"><pre>require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">haml</span><span style="color:#710">'</span></span>&#x000A;require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">redcarpet</span><span style="color:#710">'</span></span>&#x000A;&#x000A;<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">CustomRedcarpet</span> &lt; <span style="color:#036;font-weight:bold">Redcarpet</span>::<span style="color:#036;font-weight:bold">Render</span>::<span style="color:#036;font-weight:bold">HTML</span>&#x000A;  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">image</span>(link, title, alt_text)&#x000A;    <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">&lt;figure&gt;&lt;a href='</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>link<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">'&gt;&lt;img src='</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>link<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">' alt='</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>alt_text<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">' /&gt;&lt;/a&gt;&lt;figcaption&gt;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>title<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">&lt;/figcaption&gt;&lt;/figure&gt;</span><span style="color:#710">&quot;</span></span>&#x000A;  <span style="color:#080;font-weight:bold">end</span>&#x000A;<span style="color:#080;font-weight:bold">end</span>&#x000A;&#x000A;<span style="color:#080;font-weight:bold">module</span> <span style="color:#B06;font-weight:bold">Haml::Filters</span>&#x000A;&#x000A;  remove_filter(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Markdown</span><span style="color:#710">&quot;</span></span>)&#x000A;&#x000A;  <span style="color:#080;font-weight:bold">module</span> <span style="color:#B06;font-weight:bold">Markdown</span>&#x000A;    include <span style="color:#036;font-weight:bold">Haml</span>::<span style="color:#036;font-weight:bold">Filters</span>::<span style="color:#036;font-weight:bold">Base</span>&#x000A;&#x000A;    <span style="color:#33B">@renderer</span> = <span style="color:#036;font-weight:bold">Redcarpet</span>::<span style="color:#036;font-weight:bold">Markdown</span>.new(<span style="color:#036;font-weight:bold">CustomRedcarpet</span>.new())&#x000A;&#x000A;    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">render</span>(text)&#x000A;      <span style="color:#33B">@renderer</span>.render(text)&#x000A;    <span style="color:#080;font-weight:bold">end</span>&#x000A;  <span style="color:#080;font-weight:bold">end</span>&#x000A;<span style="color:#080;font-weight:bold">end</span></pre></div>
        </div>
        <div id='disqus_thread'></div>
        <script>
           var disqus_shortname = 'joeframbach';
           var disqus_identifier = 'extending-markdown-with-redcarpet';
           var disqus_title = 'Extending Markdown with Redcarpet';
           var disqus_url = 'http://joe.framba.ch/extending-markdown-with-redcarpet';
        </script>
        <script src='//joeframbach.disqus.com/embed.js' type='text/javascript'></script>
      </div>
    </div>
    <div id='footer'>
      <script>
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-39466959-1']);
        _gaq.push(['_trackPageview']);
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      </script>
    </div>
  </body>
</html>
